<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <base href="/" />
    
    <!-- PWA Setup -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#09090b">
    <meta name="description" content="Um PWA serverless para visualizar PDFs do Google Drive, fazer anotações e sincronizar com Firestore.">
    
    <!-- iOS Specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Leitor PDF">
    <link rel="apple-touch-icon" href="/icons/icon.svg">
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
    
    <!-- PWA & Social Meta Tags (Required for PWABuilder Score) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pdf-reader-app.pages.dev/">
    <meta property="og:title" content="Leitor de PDF">
    <meta property="og:description" content="Um PWA serverless para visualizar PDFs do Google Drive, fazer anotações e sincronizar com Firestore.">
    <meta property="og:image" content="/icons/icon.svg">
    
    <title>Leitor de PDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: 'var(--brand)',
              bg: 'var(--bg-main)',
              surface: 'var(--bg-surface)',
              sidebar: 'var(--bg-sidebar)',
              text: 'var(--text-main)',
              'text-sec:': 'var(--text-sec)',
              border: 'var(--border-color)',
            },
            fontFamily: {
              sans: ['"Google Sans"', 'Inter', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <!-- PDF.js Worker style fix for some environments - DOWNGRADED TO 4.8.69 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.8.69/web/pdf_viewer.css">
    
    <!-- KaTeX CSS for Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- Google Fonts: Inter (UI) & "Bunker Fonts" (PDF Metrics) -->
    <!-- Arimo = Metric Compatible with Arial -->
    <!-- Tinos = Metric Compatible with Times New Roman -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Arimo:ital,wght@0,400;0,700;1,400;1,700&family=Tinos:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    
<style>
  /* --- THEME VARIABLES --- */
  :root {
    /* Padrão: Midnight (Meia-noite) */
    --bg-main: #09090b;
    --bg-surface: #09090b;
    --bg-sidebar: #000000;
    --bg-paper: #18181b; /* Papel Escuro */
    --text-main: #fafafa;
    --text-sec: #a1a1aa;
    --brand: #ffffff;
    --border-color: #27272a;
    --accent-glow: rgba(255, 255, 255, 0.1);
  }

  /* 1. Slate (Antigo Padrão) */
  .slate {
    --bg-main: #0f172a;
    --bg-surface: #1e293b;
    --bg-sidebar: #1e293b;
    --bg-paper: #334155;
    --text-main: #f1f5f9;
    --text-sec: #94a3b8;
    --brand: #6366f1;
    --border-color: #334155;
    --accent-glow: rgba(99, 102, 241, 0.2);
  }

  /* 2. Alto Contraste */
  .high-contrast {
    --bg-main: #000000;
    --bg-surface: #000000;
    --bg-sidebar: #000000;
    --bg-paper: #000000;
    --text-main: #ffffff;
    --text-sec: #ffff00;
    --brand: #ffff00; /* Botões amarelos */
    --border-color: #ffffff;
  }
  .high-contrast .btn-primary {
    background-color: #ffff00 !important;
    color: #000000 !important;
    font-weight: bold;
  }

  /* 3. MN (Dark Moderno) */
  .mn {
    --bg-main: #1a1a1a;
    --bg-surface: #2c2c2c;
    --bg-sidebar: #212121;
    --bg-paper: #262626;
    --text-main: #f0f0f0;
    --text-sec: #a0a0a0;
    --brand: #48bb78; /* Verde menta */
    --border-color: #404040;
  }

  /* 5. Aurora Galática */
  .galactic-aurora {
    --bg-main: #0F1014;
    --bg-surface: #181920;
    --bg-sidebar: #131419;
    --bg-paper: #1A1B23;
    --text-main: #ffffff;
    --text-sec: #4CC9F0;
    --brand: #4CC9F0; /* Ciano Cyber */
    --border-color: #2E2F3E;
  }
  .galactic-aurora .btn-primary {
    background: linear-gradient(90deg, #D90429, #0055FF) !important;
    border: none;
  }

  /* 6. Ano do Dragão */
  .dragon-year {
    --bg-main: #f3e5ca; /* Bege Pergaminho */
    --bg-surface: #FFF8E7;
    --bg-sidebar: #5D0E0E; /* Vermelho Profundo */
    --bg-paper: #FFFCF5; /* Papel Pergaminho Claro */
    --text-main: #3E2723; /* Marrom Café */
    --text-sec: #5D4037;
    --brand: #B71C1C;
    --border-color: #D4AF37; /* Dourado */
  }
  /* Ajustes específicos para sidebar neste tema (texto claro na sidebar escura) */
  .dragon-year .sidebar-text {
    color: #FFD700 !important;
  }
  /* Custom Menu Button Style for Dragon Year Theme (Gold & Red 3D Button) */
  .dragon-year .custom-menu-btn {
    background-color: #FFC107 !important; /* Amber equivalent */
    color: #991B1B !important; /* Red-800 text */
    border: 2px solid #7F1D1D !important; /* Red-900 border */
    border-radius: 12px !important;
    box-shadow: 0 4px 0 #7F1D1D !important; /* 3D effect shadow */
    opacity: 1 !important;
    transition: all 0.1s ease-in-out;
  }
  .dragon-year .custom-menu-btn:active {
    transform: translateY(4px) !important;
    box-shadow: none !important;
  }
  
  /* Apply Google Sans / Inter globally for UI, but rely on Bunker fonts for PDF layer */
  body {
    font-family: 'Google Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    overscroll-behavior-y: none; /* Previne o efeito elástico no Android que revela o fundo do browser */
    
    /* BLOQUEIA SELEÇÃO NATIVA (EXCETO NA CAMADA DE TEXTO DO PDF) PARA EVITAR CONFLITO DE UI */
    -webkit-touch-callout: none;
    -webkit-user-select: none; 
    user-select: none;
  }
  
  /* Permite seleção em inputs e textos editáveis */
  input, textarea {
    -webkit-user-select: text;
    user-select: text;
  }

  /* --- Tiptap Editor Styles --- */
  .ProseMirror {
    outline: none;
    font-size: 1.125rem; /* text-lg */
    line-height: 1.75;
  }
  
  .ProseMirror h1 { font-size: 2.25rem; font-weight: 800; margin-top: 1.5em; margin-bottom: 0.5em; line-height: 1.1; }
  .ProseMirror h2 { font-size: 1.875rem; font-weight: 700; margin-top: 1.25em; margin-bottom: 0.5em; }
  .ProseMirror h3 { font-size: 1.5rem; font-weight: 600; margin-top: 1em; margin-bottom: 0.5em; }
  .ProseMirror ul, .ProseMirror ol { padding-left: 1.5em; margin-bottom: 1em; }
  .ProseMirror ul { list-style-type: disc; }
  .ProseMirror ol { list-style-type: decimal; }
  .ProseMirror blockquote { border-left: 4px solid var(--brand); padding-left: 1em; font-style: italic; opacity: 0.8; margin: 1em 0; }
  .ProseMirror code { background-color: rgba(255, 255, 255, 0.1); padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; font-size: 0.85em; }
  .ProseMirror pre { background-color: #000; padding: 1em; border-radius: 8px; color: #fff; font-family: monospace; overflow-x: auto; margin: 1em 0; }
  .ProseMirror pre code { background: none; padding: 0; }
  .ProseMirror hr { border-color: var(--border-color); margin: 2em 0; }
  
  .ProseMirror img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    display: block;
    margin: 1em 0;
  }
  .ProseMirror img.ProseMirror-selectednode {
    outline: 3px solid var(--brand);
  }

  /* --- Table Styles --- */
  .ProseMirror table {
    border-collapse: collapse;
    table-layout: fixed;
    width: 100%;
    margin: 0;
    overflow: hidden;
  }
  .ProseMirror table td, .ProseMirror table th {
    min-width: 1em;
    border: 1px solid var(--border-color);
    padding: 3px 5px;
    vertical-align: top;
    box-sizing: border-box;
    position: relative;
  }
  .ProseMirror table th {
    font-weight: bold;
    text-align: left;
    background-color: rgba(255, 255, 255, 0.05);
  }
  .ProseMirror table .selectedCell:after {
    z-index: 2;
    position: absolute;
    content: "";
    left: 0; right: 0; top: 0; bottom: 0;
    background: rgba(200, 200, 255, 0.1);
    pointer-events: none;
  }
  .ProseMirror table .column-resize-handle {
    position: absolute;
    right: -2px; top: 0; bottom: 0;
    width: 4px;
    background-color: var(--brand);
    pointer-events: none;
  }

  .ProseMirror p.is-editor-empty:first-child::before {
    color: var(--text-sec);
    content: attr(data-placeholder);
    float: left;
    height: 0;
    pointer-events: none;
  }

  /* --- React Node Views --- */
  .react-renderer {
    border: 2px solid transparent;
    border-radius: 0.5rem;
    transition: all 0.2s;
  }
  .react-renderer.ProseMirror-selectednode {
    border-color: var(--brand);
  }

  /* --- PDF.js Custom Text Layer Overrides --- */
  .textLayer {
    opacity: 1 !important;
    z-index: 10;
    user-select: text !important; 
    -webkit-user-select: text !important;
    line-height: 1.0;
    
    /* DISABLES NATIVE TOUCH CALLOUT ON MOBILE (Copy/Share menu) */
    -webkit-touch-callout: none !important;
  }

  .textLayer > span {
    color: transparent; 
    cursor: text;
    user-select: text;
    -webkit-user-select: text;
    
    height: auto !important;
    min-height: 1em;
    overflow: visible !important;
    line-height: 1.0 !important;
    white-space: pre;
    transform-origin: 0% 0%;
  }
  
  .textLayer br {
    display: block;
    content: "";
    height: 0;
  }
  
  ::selection {
    background: rgba(255, 255, 0, 0.4); 
    color: transparent;
  }
  
  ::-moz-selection {
    background: rgba(255, 255, 0, 0.4);
    color: transparent;
  }

  /* --- PRINT STYLES (Clean PDF Export) --- */
  @media print {
    body * {
      visibility: hidden;
    }
    .doc-page, .doc-page * {
      visibility: visible;
    }
    .doc-page {
      position: absolute;
      left: 0;
      top: 0;
      width: 100% !important;
      margin: 0 !important;
      box-shadow: none !important;
      border: none !important;
      background-color: white !important; /* Force white paper for print */
      color: black !important; /* Force black text */
      transform: none !important;
      padding: 0 !important;
    }
    
    /* Hide UI elements marked as no-print */
    .no-print {
      display: none !important;
    }

    /* Reset ProseMirror styles for print */
    .ProseMirror {
      padding: 2cm !important; /* Standard A4 margins */
    }
    .ProseMirror p, .ProseMirror h1, .ProseMirror h2, .ProseMirror h3 {
      color: black !important;
    }
  }

  /* --- FONT DEFINITIONS OMITTED FOR BREVITY (Same as before) --- */
  @font-face {
    font-family: 'TimesNewRoman';
    src: local('Tinos'), local('Times New Roman'), local('Times');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  /* ... (Other fonts remain) ... */
  @font-face {
    font-family: 'Arial';
    src: local('Arimo'), local('Arial'), local('Helvetica');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
</style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "pdfjs-dist": "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.8.69/+esm",
    "pdf-lib": "https://aistudiocdn.com/pdf-lib@^1.17.1",
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1",
    "idb": "https://aistudiocdn.com/idb@^8.0.3",
    "tesseract.js": "https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/+esm",
    "@google/genai": "https://esm.sh/@google/genai",
    "react-window": "https://esm.sh/react-window@1.8.10?external=react,react-dom",
    "react-virtualized-auto-sizer": "https://esm.sh/react-virtualized-auto-sizer@1.0.24?external=react,react-dom",
    "@tiptap/react": "https://esm.sh/@tiptap/react@2.2.4",
    "@tiptap/pm": "https://esm.sh/@tiptap/pm@2.2.4",
    "@tiptap/starter-kit": "https://esm.sh/@tiptap/starter-kit@2.2.4",
    "@tiptap/extension-underline": "https://esm.sh/@tiptap/extension-underline@2.2.4",
    "@tiptap/extension-text-align": "https://esm.sh/@tiptap/extension-text-align@2.2.4",
    "@tiptap/extension-image": "https://esm.sh/@tiptap/extension-image@2.2.4",
    "@tiptap/extension-link": "https://esm.sh/@tiptap/extension-link@2.2.4",
    "@tiptap/extension-table": "https://esm.sh/@tiptap/extension-table@2.2.4",
    "@tiptap/extension-table-row": "https://esm.sh/@tiptap/extension-table-row@2.2.4",
    "@tiptap/extension-table-cell": "https://esm.sh/@tiptap/extension-table-cell@2.2.4",
    "@tiptap/extension-table-header": "https://esm.sh/@tiptap/extension-table-header@2.2.4",
    "@tiptap/extension-bubble-menu": "https://esm.sh/@tiptap/extension-bubble-menu@2.2.4",
    "katex": "https://esm.sh/katex@0.16.9",
    "mermaid": "https://esm.sh/mermaid@10.9.0",
    "qrcode": "https://esm.sh/qrcode@1.5.3"
  }
}
</script>
</head>
  <body class="bg-bg text-text overflow-hidden transition-colors duration-300">
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('SW registered: ', registration);
          }).catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
        });
      }
    </script>
  </body>
</html>